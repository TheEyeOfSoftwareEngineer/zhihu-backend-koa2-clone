## 话题模块
- 话题的增改查
- 分页和模糊搜索
- 用户属性中的话题引用
- 关注/取消关注话题、用户关注的话题列表

### 模型层
```javascript
const mongoose = require('mongoose')

const { Schema, model } = mongoose

const topicSchema = new Schema({
  __v : {type: Number, select: false},
  name: {type: String, required: true},
  avatar_url: {type: String},
  introduction: {type: String, select: false},
})

module.exports = model('Topic', topicSchema)
```

### 控制器
```javascript
const Topic = require('../models/topics')

class TopicController {

  async find(ctx) {
    ctx.body =  await Topic.find()
  }

  async findById(ctx) {
    const {fields= ''} = ctx.query
    const selectFields = fields.split(';').filter(f=>f).map(f => " +" + f).join('')
    const topic = await Topic.findById(ctx.params.id).select(selectFields)
    ctx.body = topic
  }

  async create(ctx) {
    ctx.verifyParams({
      name: {type: 'string', required: true},
      avatar_url: {type: 'string', required: false},
      introduction: {type: 'string', required: false}
    })
    const topic = await new Topic(ctx.request.body).save()
    ctx.body = topic
  }

  async update(ctx) {
    ctx.verifyParams({
      name: {type: 'string', required: false},
      avatar_url: {type: 'string', required: false},
      introduction: {type: 'string', required: false}
    })
    const topic = await Topic.findByIdAndUpdate(ctx.params.id, ctx.request.body)
    ctx.body = topic
  }
}

module.exports = new TopicController();
```

### 路由层
```javascript
const router = require('koa-router')()
router.prefix('/api/topics')

const { auth } = require('../middlewares/auth')

const {
  find, findById, create, update
} = require('../controllers/topics')

router.get('/', find)
router.post('/', auth, create)
router.get('/:id', findById)
router.patch('/:id', auth, update)

module.exports = router
```

### 分页
- 实现分页逻辑
```javascript
  async find(ctx) {
    const {per_page = 10} = ctx.query
    const page = Math.max(ctx.query.page * 1, 1) - 1
    const perPage = Math.max(per_page * 1, 1)
    ctx.body =  await Topic.find().limit(perPage).skip(page * perPage)
  }
```

### 模糊搜索
```javascript
async find(ctx) {
    const {per_page = 10} = ctx.query
    const page = Math.max(ctx.query.page * 1, 1) - 1
    const perPage = Math.max(per_page * 1, 1)
    ctx.body =  await Topic.find({name: new RegExp(ctx.query.q)}).limit(perPage).skip(page * perPage)
  }
```

